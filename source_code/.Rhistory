# Convert to interactive plot
ggplotly(p, tooltip="text_label")
df_mental_health <-df %>%
rename(
Province = Geography,
Mental_Health_Indicator = Indicators,
Population_Affected = Number.of.persons,
Percentage_Affected = Percent
)
suicide_df <- read_excel("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/processed/suicide rate.xlsx")
df_suicide <- suicide_df
# Suicide rates by provinces and gender
library(readxl)
suicide_df <- read_excel("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/processed/suicide rate.xlsx")
df_suicide <- suicide_df
df_mental_health <-df %>%
rename(
Province = Geography,
Mental_Health_Indicator = Indicators,
Population_Affected = Number.of.persons,
Percentage_Affected = Percent
)
# Load required libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(ggthemes)
library(corrplot)
library(tidyverse)
library(readr)
source("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/source_code/3. EDA Descriptive Analysis.R", echo=TRUE)
df_mental_health <-df %>%
rename(
Province = Geography,
Mental_Health_Indicator = Indicators,
Population_Affected = Number.of.persons,
Percentage_Affected = Percent
)
df_suicide <- suicide_df %>%
rename(
Province = Geo,
Suicide_Rate = rate
) %>%
mutate(Age_Group = "Total 15++ Years")
df_combined <- df_suicide %>%
left_join(df_mental_health, by = c("Year", "Province", "Gender", "Age_Group"))
correlation_data <- df_combined %>%
select(Suicide_Rate, Percentage_Affected) %>%  # Only use numeric data
drop_na()  # Remove missing values
# Compute correlation matrix
cor_matrix <- cor(correlation_data, use="pairwise.complete.obs")
# Print correlation results
print("Correlation Matrix:")
print(cor_matrix)
correlation_data <- df_combined %>%
select(Suicide_Rate, Percentage_Affected) %>%  # Only use numeric data
drop_na()  # Remove missing values
View(df_combined)
df_combined <- df_mental_healthd %>%
left_join(f_suicide, by = c("Year", "Province", "Gender", "Age_Group"))
df_combined <- df_mental_health %>%
left_join(df_suicide, by = c("Year", "Province", "Gender", "Age_Group"))
correlation_data <- df_combined %>%
select(Suicide_Rate, Percentage_Affected) %>%  # Only use numeric data
drop_na()  # Remove missing values
# Compute correlation matrix
cor_matrix <- cor(correlation_data, use="pairwise.complete.obs")
View(df_combined)
View(df_combined)
df_combined <- df_mental_health %>%
left_join(df_suicide, by = c("Year", "Province", "Gender", "Age_Group"))
correlation_data <- df_combined %>%
select(Suicide_Rate, Percentage_Affected) %>%  # Only use numeric data
drop_na()  # Remove missing values
# Compute correlation matrix
cor_matrix <- cor(correlation_data, use="pairwise.complete.obs")
# Print correlation results
print("Correlation Matrix:")
corrplot(cor_matrix, method="color", type="lower", tl.cex=0.8, tl.col="black")
# Save correlation results as CSV (Optional)
write_csv(df_combined, "merged_suicide_mental_health_data.csv")
View(df_filtered)
View(df_suicide)
View(df)
View(df)
View(df)
#Merge 2 datasets
df_mental_health <-df %>%
rename(
Population_Affected = Number.of.persons,
Percentage_Affected = Percent
)%>%
select(!DGUID)
View(df_mental_health)
df_suicide <- suicide_df %>%
rename(
Geography = Geo,
Suicide_Rate = rate
) %>%
mutate(
Age_Group = "Total 15++ Years",     # Ensure all suicide data has the same age group
Indicators = "Commit Suicide",      # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
)
df_suicide <- suicide_df %>%
df_suicide <- suicide_df %>%
rename(
Geography = Geo,
Suicide_Rate = rate
) %>%
mutate(
Age_Group = "Total 15++ Years",     # Ensure all suicide data has the same age group
Indicators = "Commit Suicide",      # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
))
View(df_suicide)
df_suicide <- read_csv("suicide_rate.csv") %>%
rename(
Population_Affected = Total,  # Rename Total to Population_Affected
Percentage_Affected = rate  # Rename rate to Percentage_Affected
) %>%
mutate(
Age_Group = "Total 15++ Years",  # Standardized age group
Indicators = "Commit Suicide",   # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
),
Population_Affected = as.integer(Population_Affected)  # Convert Population_Affected to integer
)
df_suicide <- suicide_df %>%
rename(
Population_Affected = Total,  # Rename Total to Population_Affected
Percentage_Affected = rate  # Rename rate to Percentage_Affected
) %>%
mutate(
Age_Group = "Total 15++ Years",  # Standardized age group
Indicators = "Commit Suicide",   # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
),
Population_Affected = as.integer(Population_Affected)  # Convert Population_Affected to integer
)
View(df_suicide)
#Merge 2 datasets
df_mental_health <-df %>%
rename(
Population_Affected = Number.of.persons,
Percentage_Affected = Percent
)%>%
select(!DGUID)
View(df_mental_health)
df_combined <- df_mental_health %>%
left_join(df_suicide)
View(df_combined)
df_combined <- df_mental_health %>%
join(df_suicide)
df_combined <- df_mental_health %>%
join_by(df_suicide)
View(df_combined)
#Merge 2 datasets
df_mental_health <-df %>%
rename(
Population = Number.of.persons,
Percentage = Percent
)%>%
select(!DGUID)
df_suicide <- suicide_df %>%
rename(
Population = Total,  # Rename Total to Population_Affected
Percentage = rate  # Rename rate to Percentage_Affected
) %>%
mutate(
Age_Group = "Total 15++ Years",  # Standardized age group
Indicators = "Commit Suicide",   # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
),
Population_Affected = as.integer(Population_Affected)  # Convert Population_Affected to integer
)
df_combined <- full_join(df_mental_health, df_suicide,
by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
df_combined <- df_mental_health %>%
left_join(df_suicide,
by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
df_combined <- df_mental_health %>%
left_join(df_suicide, by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
View(df)
df_suicide <- suicide_df %>%
rename(
Population = Total,  # Rename Total to Population_Affected
Percentage = rate  # Rename rate to Percentage_Affected
Geography = Geo
df_suicide <- suicide_df %>%
rename(
Population = Total,  # Rename Total to Population_Affected
Percentage = rate,  # Rename rate to Percentage_Affected
Geography = Geo
) %>%
mutate(
Age_Group = "Total 15++ Years",  # Standardized age group
Indicators = "Commit Suicide",   # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
),
Population_Affected = as.integer(Population_Affected)  # Convert Population_Affected to integer
)
df_combined <- df_mental_health %>%
left_join(df_suicide, by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
View(df_suicide)
df_suicide <- suicide_df %>%
rename(
Population = Total,  # Rename Total to Population_Affected
Percentage = rate,  # Rename rate to Percentage_Affected
Geography = Geo
) %>%
mutate(
Age_Group = "Total 15++ Years",  # Standardized age group
Indicators = "Commit Suicide",   # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
),
Population_Affected = as.integer(Population_Affected)  # Convert Population_Affected to integer
)
suicide_df <- read_excel("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/processed/suicide rate.xlsx")
df_suicide <- suicide_df
#Merge 2 datasets
df_mental_health <-df %>%
rename(
Population = Number.of.persons,
Percentage = Percent
)%>%
select(!DGUID)
df_suicide <- suicide_df %>%
rename(
Population = Total,  # Rename Total to Population_Affected
Percentage = rate,  # Rename rate to Percentage_Affected
Geography = Geo
) %>%
mutate(
Age_Group = "Total 15++ Years",  # Standardized age group
Indicators = "Commit Suicide",   # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
),
Population_Affected = as.integer(Population_Affected)  # Convert Population_Affected to integer
)
df_suicide <- suicide_df %>%
rename(
Population = Total,  # Rename Total to Population_Affected
Percentage = rate,  # Rename rate to Percentage_Affected
Geography = Geo
) %>%
mutate(
Age_Group = "Total 15++ Years",  # Standardized age group
Indicators = "Commit Suicide",   # Standardized indicator
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender  # Keep as is for any other values
),
Population = as.integer(Population)  # Convert Population_Affected to integer
)
df_combined <- df_mental_health %>%
left_join(df_suicide, by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
View(df_combined)
df_combined <- df_mental_health %>%
left_join(df_suicide, by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
View(df_combined)
df_combined <- df_mental_health %>%
right_join(df_suicide, by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
View(df_combined)
df_combined <- df_mental_health %>%
full_join(df_suicide, by = c("Year", "Geography", "Gender", "Age_Group", "Indicators","Population","Percentage"))
View(df_combined)
# Save correlation results as CSV (Optional)
write_csv(df_combined, "merged_suicide_mental_health_data.csv")
df_canada <- df_combined %>%
filter(Geography == "Canada")  # Only include national-level data
df_wide <- df_canada %>%
select(Year, Gender, Indicators, Percentage) %>%  # Select relevant columns
spread(key = Indicators, value = Percentage)  # Pivot wider so each indicator is a column
corrplot(cor_matrix, method = "color", type = "lower", tl.cex = 0.8, tl.col = "black")
# Remove non-numeric columns before correlation analysis
cor_matrix <- df_wide %>%
select(-Year, -Gender) %>%  # Exclude categorical variables
cor(use = "pairwise.complete.obs")  # Compute correlation ignoring missing values
df_wide <- df_canada %>%
select(Year, Gender, Indicators, Percentage) %>%  # Select relevant columns
spread(key = Indicators, value = Percentage)  # Pivot wider so each indicator is a column
df_canada <- df_canada %>%
group_by(Year, Gender, Indicators) %>%
summarise(Percentage = mean(Percentage, na.rm = TRUE), .groups = "drop")  # Average duplicate values
df_wide <- df_canada %>%
select(Year, Gender, Indicators, Percentage) %>%  # Select relevant columns
spread(key = Indicators, value = Percentage)  # Pivot wider so each indicator is a column
# Remove non-numeric columns before correlation analysis
cor_matrix <- df_wide %>%
select(-Year, -Gender) %>%  # Exclude categorical variables
cor(use = "pairwise.complete.obs")  # Compute correlation ignoring missing values
corrplot(cor_matrix, method = "color", type = "lower", tl.cex = 0.8, tl.col = "black")
df_canada <- df_canada %>%
group_by(Year, Gender, Indicators) %>%
summarise(Percentage = mean(Percentage, na.rm = TRUE), .groups = "drop")  # Average duplicate values
df_wide <- df_canada %>%
pivot_wider(names_from = Indicators, values_from = Percentage)
cor_matrix <- df_wide %>%
select(-Year, -Gender) %>%  # Exclude categorical variables
cor(use = "pairwise.complete.obs")  # Compute correlation ignoring missing values
corrplot(cor_matrix, method = "color", type = "lower", tl.cex = 0.8, tl.col = "black")
corrplot(cor_matrix, method = "color", type = "lower", tl.cex = 0.8, tl.col = "black")
# Remove non-numeric columns before correlation analysis
cor_matrix <- df_wide %>%
select(-Year, -Gender) %>%  # Exclude categorical variables
cor(use = "pairwise.complete.obs")  # Compute correlation ignoring missing values
dev.off()  # Clears plotting device to fix the text margin warning
corrplot(cor_matrix, method = "color", type = "lower",
tl.cex = 0.7, tl.srt = 45, tl.col = "black")
View(cor_matrix)
cor_long <- melt(cor_matrix)
library(ggplot2)
library(dplyr)
library(tidyr)
library(ggthemes)
library(corrplot)
library(tidyverse)
library(readr)
library(reshape2)
cor_long <- melt(cor_matrix)
ggplot(cor_long, aes(x = Var1, y = Var2, fill = value)) +
geom_tile() +
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1, 1),
name = "Correlation") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(title = "Correlation Heatmap: Mental Health Indicators & Suicide (Canada Total)")
ggplot(cor_long, aes(x = Var1, y = Var2, fill = value)) +
geom_tile(color = "white") +  # Creates heatmap tiles
geom_text(aes(label = round(value, 2)), size = 4, color = "black") +  # Adds correlation numbers
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1, 1),
name = "Correlation") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(title = "Correlation Heatmap: Mental Health Indicators & Suicide (Canada Total)")
ggplot(cor_long, aes(x = Var1, y = Var2, fill = value)) +
geom_tile(color = "white") +  # Creates heatmap tiles
geom_text(aes(label = round(value, 2)), size = 4, color = "black") +  # Adds correlation numbers
scale_fill_gradient2(low = "blue", high = "red", mid = "white",
midpoint = 0, limit = c(-1, 1),
name = "Correlation") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(title = "Correlation Heatmap: Mental Health Indicators & Suicide")
ggplot(map_data) +
geom_sf(aes(fill = Total), color = "white") +
geom_text(data = map_data_centroids, aes(x = longitude, y = latitude, label = Total),
size = 2, color = "black") +
scale_fill_gradient(low = "lightblue", high = "darkred", name = "Total Suicides") +
facet_wrap(~ Year) +  # Separate maps by year
theme_void() +
labs(title = "Total Suicides by Province in Canada (2002, 2012, 2022)")
library(ggplot2)
library(dplyr)
library(tidyr)
library(ggthemes)
library(corrplot)
library(tidyverse)
library(readr)
library(reshape2)
df<- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/processed/cleaned_mental_health_data.csv")
# How have mental health indicators changes across age, province, genders in 2002-2012-2022 ???
## BY AGE
### Group data by year and age group
age_trends <- df %>%
filter(Age_Group != "Total 15++ Years")%>%
group_by(Year, Age_Group) %>%
summarise(Average_MH_Indicator = mean(Percent, na.rm = TRUE))
### Plot trends over time for different age groups
ggplot(age_trends, aes(x=Year, y=Average_MH_Indicator, color=Age_Group, group=Age_Group)) +
geom_line(size=1) +
geom_point(size=2) +
theme_minimal() +
labs(title="Mental Health Trends Across Age Groups (2002-2022)",
x="Year", y="Average Mental Health Indicator (%)") +
ylim(4,NA)+
theme(legend.position="bottom")
## BY GEOGRAPHY
# Filter and group data
province_trends <- df %>%
filter(Geography != "Canada") %>%
group_by(Year, Geography) %>%
summarise(Average_MH_Indicator = mean(Percent, na.rm = TRUE))
# Facet grid for better comparison
ggplot(province_trends, aes(x=Year, y=Average_MH_Indicator, color=Geography)) +
geom_line(size=1) +
geom_point(size=2) +
facet_wrap(~ Geography, scales="free_y") +
theme_minimal() +
labs(title="Mental Health Trends by Province",
x="Year", y="Average Mental Health Indicator (%)") +
ylim(4, NA) +
theme(legend.position="none")
## BY GENDER
gender_trends <- df %>%
group_by(Year, Gender) %>%
summarise(Average_MH_Indicator = mean(Percent, na.rm = TRUE))
ggplot(gender_trends, aes(x=Year, y=Average_MH_Indicator, color=Gender)) +
geom_line(size=1) +
theme_minimal() +
labs(title="Mental Health Trends by Gender",
x="Year", y="Average Mental Health Indicator (%)") +
scale_color_manual(values=c("blue","purple", "pink" ))
# Suicide rates by provinces and gender
library(readxl)
suicide_df <- read_excel("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/processed/suicide rate.xlsx")
df_suicide <- suicide_df
## BY GEOGRAPHY
# Filter and group data
province.suicide_trends <- suicide_df %>%
filter(Geo != "Canada") %>%
group_by(Year, Geo) %>%
summarise(Average_MH_Indicator = mean(Total, na.rm = TRUE))
ggplot(province.suicide_trends, aes(x=Year, y=Average_MH_Indicator, color=Geo)) +
geom_line(size=1) +
geom_point(size=2) +
facet_wrap(~ Geo, scales="free_y") +
theme_minimal() +
labs(title="Suicide Trends by Province",
x="Year", y="Average Number Suicide") +
theme(legend.position="none")
suicide_by_gender <- suicide_df %>%
group_by(Year, Gender) %>%
summarise(Average_Suicide_Rate = mean(rate, na.rm = TRUE))
# Plot suicide trends by gender
ggplot(suicide_by_gender, aes(x=Year, y=Average_Suicide_Rate, color=Gender, group=Gender)) +
geom_line(size=1) +
geom_point(size=2) +
theme_minimal() +
labs(title="Suicide Rate Trends by Gender (2002-2022)",
x="Year", y="Suicide Rate per 100,000") +
scale_color_manual(values=c("pink","blue", "purple"))
library(units)
library(tidyverse)
library(ggplot2)
library(sf)
library(ggthemes)
library(rnaturalearth)
library(rnaturalearthdata)
df_filtered <- df_suicide %>%
filter(Year %in% c(2002, 2012, 2022), Gender == "T", Geo != "Canada") %>%
select(-rate)  # Remove the rate column
canada_map <- ne_states(country = "Canada", returnclass = "sf")
map_data <- canada_map %>%
left_join(df_filtered, by = c("name" = "Geo"))
map_data_centroids <- map_data %>%
mutate(geometry = st_centroid(geometry)) %>%
mutate(longitude = st_coordinates(geometry)[,1],
latitude = st_coordinates(geometry)[,2])
# Plot suicide numbers by province
ggplot(map_data) +
geom_sf(aes(fill = Total), color = "white") +
geom_text(data = map_data_centroids, aes(x = longitude, y = latitude, label = Total),
size = 2, color = "black") +
scale_fill_gradient(low = "lightblue", high = "darkred", name = "Total Suicides") +
facet_wrap(~ Year) +  # Separate maps by year
theme_void() +
labs(title = "Total Suicides by Province in Canada (2002, 2012, 2022)")
df_suicide <- suicide_df %>%
rename(
Population = Total,
Percentage = rate,
Geography = Geo
) %>%
mutate(
Age_Group = "Total 15++ Years",
Indicators = "Commit Suicide",
Gender = case_when(
Gender == "T" ~ "Total, gender of person",
Gender == "M" ~ "Men+",
Gender == "F" ~ "Women+",
TRUE ~ Gender
),
Population = as.integer(Population)
)
